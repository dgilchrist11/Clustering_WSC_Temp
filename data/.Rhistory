install.packages("tinyhydat")
library(tidyverse)
library(tidyverse)
readxl::read_xls("Z:/Bevington/Drew/Survey_Data.xlsx", sheet = "Sheet 2")
readxl::read_xls("Z:/Bevington/Drew/Survey_Data.xlsx", sheet = 2)
readxl::read_xls("Z:/Bevington/Drew/Survey_Data.xlsx")
readxl::read_xlsx("Z:/Bevington/Drew/Survey_Data.xlsx")
df <- readxl::read_xlsx("Z:/Bevington/Drew/Survey_Data.xlsx", sheet = 2)
df <- readxl::read_xlsx("Z:/Bevington/Drew/Survey_Data.xlsx", sheet = "Sheet2")
df <- readxl::read_xlsx("C:/alex_temp/Survey_Data.xlsx", sheet = "Sheet2", )
df %>%
ggplot() +
geom_point(aes(Date, Name, symbol = `Elev (m)`))
df
df %>%
filter(Site == "Hungary Creek at Hwy 16")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_point(aes(Date, Name, symbol = `ELEV (m)`))
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_point(aes(Date, `ELEV (m)`, symbol = Name))
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_point(aes(Date, `ELEV (m)`, shape = Name))
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_point(aes(Date, `ELEV (m)`, shape = Name))
df <- readxl::read_xlsx("C:/alex_temp/Survey_Data.xlsx", sheet = "Sheet1", )
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_point(aes(Date, `ELEV (m)`, shape = Name))
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003), ymax = `ELEV (m)`+.003)) +
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003)) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 5) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
?geom_errorbar
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 0.5) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
library(plotly)
install.packages("plotly")
# install.packages("plotly")
library(plotly)
ggplotly(
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)))
install.packages("googlesheets4")
# install.packages("googlesheets4")
library(googlesheets4)
read_sheet("https://docs.google.com/spreadsheets/d/1gm1VDHdItYgRJnE8NU4umivxsTQ_QcbL1vJ_Xajd2A4/edit?gid=1274205715", sheet = "HY_Benchmarks")
df <- read_sheet("https://docs.google.com/spreadsheets/d/1gm1VDHdItYgRJnE8NU4umivxsTQ_QcbL1vJ_Xajd2A4/edit?gid=1274205715", sheet = "HY_Benchmarks")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
mutate(Name = toupper(Name))
df <- df %>%
mutate(Name = toupper(Name))
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), width = 1) +
geom_point(aes(Date, `ELEV (m)`)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), width = 1) +
geom_point(aes(Date, `ELEV (m)`, color = Name)) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), width = 1) +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), width = 1) +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21, size = 2) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015)) +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21, size = 2) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), color = "grey") +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21, size = 2) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), color = "grey40") +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21, size = 2) +
facet_wrap(.~Name, scales = "free_y")
df %>%
filter(Site == "Hungary Creek at Hwy 16") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), color = "red") +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21, size = 2) +
facet_wrap(.~Name, scales = "free_y")
df <- df %>%
mutate(Name = toupper(Name))
df %>%
filter(Site == "Pelly Creek West of Mt Russel") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), color = "red") +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21, size = 2) +
facet_wrap(.~Name, scales = "free_y")
ggplotly(
df %>%
filter(Site == "Pelly Creek West of Mt Russel") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)))
df %>%
filter(Site == "Pelly Creek West of Mt Russel") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.0015, ymax = `ELEV (m)`+.0015), color = "red") +
geom_point(aes(Date, `ELEV (m)`, fill = Name), shape = 21, size = 2) +
facet_wrap(.~Name, scales = "free_y")
ggplotly(
df %>%
filter(Site == "Pelly Creek West of Mt Russel") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)))
ggplotly(
df %>%
filter(Site == "Pelly Creek West of Mt Russel") %>%
ggplot() +
geom_line(aes(Date, `ELEV (m)`, shape = Name)) +
geom_errorbar(aes(Date, `ELEV (m)`, ymin = `ELEV (m)`-.003, ymax = `ELEV (m)`+.003), width = 1) +
geom_point(aes(Date, `ELEV (m)`, shape = Name)))
library(dplyr)
library(lubridate)
setwd("C:\\Users\\DGILCHRI\\OneDrive - Government of BC\\Hydro-Summary-Report\\code")
TW<-read.csv("TW_data.csv")
glimpse(TW)
View(TW)
OK<-TW %>%
filter(StationID == "08NM085")
View(OK)
dup <- TW %>%
group_by(Date, StationName) %>%
filter(n() > 1) %>%
ungroup()
dup <- TW %>%
group_by(DateTime_UTC, StationName) %>%
filter(n() > 1) %>%
ungroup()
# Display or export the duplicate data
glimpse(dup)
View(dup)
setwd("C:\Users\DGILCHRI\OneDrive - Government of BC\Hydro-Summary-Report\Clustering_WSC_Temp\data")
setwd("C:\\Users\\DGILCHRI\\OneDrive - Government of BC\\Hydro-Summary-Report\\Clustering_WSC_Temp\\data")
mega <- read.csv("mega_2024.csv")
mega$date<-ymd(mega$date)
library(tidyverse)
library(dplyr)
library(tidyhydat)
library(readxl)
library(lubridate)
library(ggplot2)
setwd("C:\\Users\\DGILCHRI\\OneDrive - Government of BC\\Hydro-Summary-Report\\Clustering_WSC_Temp\\data")
mega <- read.csv("mega_2024.csv")
mega$date<-ymd(mega$date)
glimpse(mega)
mega<- mega %>%
filter(tw <= 40) %>%
filter(tw>= -0.5) %>%
filter(file != "Envcanada_ec_tw_spot_measurements") %>%
filter(file != "QR_ProvisionalDailyValues_20151231_to_20221216")
source("C:/Users/DGILCHRI/OneDrive - Government of BC/Hydro-Summary-Report/code/CLUSTER.R", echo=TRUE)
meta<-tidyhydat::allstations %>%
select(c(STATION_NUMBER, STATION_NAME, LATITUDE, LONGITUDE,PROV_TERR_STATE_LOC ))
mega_meta <- mega %>%
left_join(meta, by = c("station_number" = "STATION_NUMBER"))
avg_monthly_tw <- mega_meta %>%
drop_na() %>% #REMOVE NA VALUES
filter(PROV_TERR_STATE_LOC == "BC") %>% #SELECT ONLY SITES IN BC
mutate(year = year(date),
month = month(date, label = TRUE)) %>% #CREATE YEAR AND MONTH COLUMNS
group_by(station_number, year, month) %>%
filter(n() > 20) %>%
group_by(station_number) %>%
mutate(nyear = n_distinct(year)) %>% #COUNT NUMBER OF YEARS OF DATA FOR EACH STATION
filter( nyear >= 10) %>% #FILTER FOR STATIONS WITH 10 OR MORE YEARS OF DATA
group_by(station_number, year, month) %>%
summarise(avg_temp = mean(tw), .groups = "drop") %>%  # CALCULATE AVERAGE MONTHLY TEMPERATURE PER YEAR
group_by(station_number, month) %>%
filter(n() >=5) %>% #MAKE SURE AVERAGES ARE BASED ON ATLEAST 5 YEARS OF AVERAGE MONTHLY DATA
summarise(avg_temp = mean(avg_temp), .groups = "drop") %>%  # CALCULATE AVERAGE MONTHLY TEMPERATURE
group_by(station_number) %>%
filter(n() == 12)
stations_reg <- hy_stn_regulation()
glimpse(avg_monthly_tw)
avg_monthly_tw<- avg_monthly_tw %>%
left_join(stations_reg, by = c("station_number" = "STATION_NUMBER")) %>%
filter(REGULATED == FALSE) %>%
ungroup() %>%
select(-c(Year_from, Year_to, REGULATED))
setwd("C:\\Users\\DGILCHRI\\OneDrive - Government of BC\\Hydro-Summary-Report\\code\\data")
saveRDS(avg_monthly_tw, "avg_monthly_tw.RDS")
avg_monthly_tw = readRDS("avg_monthly_tw.RDS")
stations_reg <- hy_stn_regulation()
glimpse(avg_monthly_tw)
avg_monthly_tw<- avg_monthly_tw %>%
left_join(stations_reg, by = c("station_number" = "STATION_NUMBER")) %>%
filter(REGULATED == FALSE) %>%
ungroup() %>%
select(-c(Year_from, Year_to, REGULATED))
setwd("C:\\Users\\DGILCHRI\\OneDrive - Government of BC\\Hydro-Summary-Report\\Clustering_WSC_Temp\\data")
saveRDS(avg_monthly_tw, "avg_monthly_tw.RDS")
avg_monthly_tw = readRDS("avg_monthly_tw.RDS")
ggplot(avg_monthly_tw, aes(x = month, y = avg_temp)) +
geom_line(group = 1, color = "blue") +
geom_point(color = "red") +
facet_wrap(~ station_number) + # FACET WRAP BY STATION NUMBER
scale_x_discrete(breaks = levels(avg_monthly_tw$month)[seq(1, 12, by = 2)]) + # FIX LABELS
labs(
title = "Average Monthly River Temperature by Station",
x = "Month",
y = "Average Temperature (°C)"
) +
theme_classic() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
strip.text = element_text(size = 8)
)
#NORMALIZE THE DATA
norm<- avg_monthly_tw %>%
group_by(station_number) %>%
mutate(norm_avg_temp = ((avg_temp - min(avg_temp)) / (max(avg_temp) - min(avg_temp)))) %>%
ungroup()
# PLOT NORMALIZED THERMAL REGIMES
ggplot(norm, aes(x = month, y = norm_avg_temp)) +
geom_line(group = 1, color = "blue") +
geom_point(color = "red") +
facet_wrap(~ station_number) + # FACET WRAP BY STATION NUMBER
scale_x_discrete(breaks = levels(avg_monthly_tw$month)[seq(1, 12, by = 2)]) + # FIX LABELS
labs(
title = "NORMALIZED Average Monthly River Temperature by Station",
x = "Month",
y = " NORMALIZED Average Temperature (°C)"
) +
theme_classic() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
strip.text = element_text(size = 8)
)
